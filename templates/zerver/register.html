{% extends "zerver/portico_signup.html" %}
{#
Gather other user information, after having confirmed
their email address.

Form is validated both client-side using jquery-validate (see signup.js) and server-side.
#}

{% block customhead %}
{{ super() }}
<script type="text/javascript" src="/static/third/zxcvbn/zxcvbn.js"></script>
{% endblock %}

{% block for_you %}for {% if company_name %} {{company_name}} {% else %} __________ {% endif %} {% endblock %}
{% block portico_content %}
<div class="center-container">
  <div class="center-block">
    <div class="pitch">
        <h1>You're almost there.</h1>
        <p>
          We just need you to do one last thing.
          Tell us a bit about yourself.
        </p>
    </div>

    <form method="post" class="form-horizontal" id="registration" action="{{ url('zerver.views.accounts_register') }}">
    {{ csrf_input }}
        <div class="input-group grid">
            <label for="id_email" class="inline-block label-title">{{ _('Email') }}</label>
            <input type='hidden' name='key' value='{{ key }}' />
            <input type='text' disabled="true" placeholder="{{ email }}" />
        </div>
        <div class="input-group grid">
            <label for="id_full_name" class="inline-block label-title">{{ _('Full name') }}</label>
            {% if lock_name %}
                <p class="fakecontrol">{{ full_name }}</p>
            {% else %}
                <input id="id_full_name" class="required" type="text" name="full_name" placeholder='{{ "John Doe" }}'
                value="{% if full_name %}{{ full_name }}{% elif form.full_name.value() %}{{ form.full_name.value() }}{% endif %}"
                       maxlength="100" />
                {% if form.full_name.errors %}
                    {% for error in form.full_name.errors %}
                        <div class="alert alert-error">{{ error }}</div>
                    {% endfor %}
                {% endif %}
            {% endif %}
        </div>

      {% if creating_new_team %}
            <div class="input-group grid">
                <label for="id_team_name" class="inline-block label-title">{{ _('Organization name') }}</label>
                <input id="id_team_name" class="required" type="text"
                    placeholder="{{ _("E.g. Acme") }}"
                    name="realm_name" maxlength="100" />
                    {% if form.realm_name.errors %}
                        {% for error in form.realm_name.errors %}
                        <div class="alert alert-error">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
            </div>

            <div class="m-v-20">
              <label for="id_org_type" class="label-title">{{ _('Organization Type') }}</label>

              {% for org_type_value, org_type_text in form.realm_org_type.field.choices %}
              <div class="input-group radio">
                <input class="required inline-block" type="radio" name="realm_org_type" value="{{ org_type_value }}"
                    {% if org_type_value == form.realm_org_type.value() %} checked {% endif %} />
                <label for="left_side_userlist" class="inline-block">{{ org_type_text }}</label>
              </div>
              {% endfor %}
            </div>
            <div class="m-v-20">
              <div class="help-box">
                All settings can be changed on the admin page.

                <div id="corporate_blob" class="blob display-none">
                  This organization is for a team within a company. The company's Zulip administrators may require administrative access to take control of other users' accounts and access their private message content for auditing purposes.
                </div>

                <div id="community_blob" class="blob">
                  The new organization's Zulip administrators will not have the authority to take control of other users' accounts or access their private message content.
                </div>
              </div>
            </div>
        {% endif %}

        {% if password_auth_enabled %}
            <div class="input-group">
                <label for="id_password" class="inline-block">{{ _('Password') }}</label>
                <div class="controls">
                    <input id="id_password" class="required" type="password" name="password"
                           value="{% if form.password.value() %}{{ form.password.value() }}{% endif %}"
                           maxlength="100" />
                    {% if full_name %}
                    <span class="help-inline">{{ _('This is used for mobile applications and other tools that require a password') }}.</span>
                    {% endif %}
                    {% if form.password.errors %}
                        {% for error in form.password.errors %}
                            <div class="alert alert-error">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
            <div class="input-group">
                <label class="inline-block">{{ _('Password strength') }}</label>
                <div class="progress" id="pw_strength">
                    <div class="bar bar-danger" style="width: 10%;"></div>
                </div>
            </div>

        {% endif %}

        {% if terms_of_service %}
            <div class="input-group float-left">
                {#
                This is somewhat subtle.
                Checkboxes have a name and value, and when the checkbox is ticked, the form posts
                with name=value. If the checkbox is unticked, the field just isn't present at all.

                This is distinct from 'checked', which determines whether the checkbox appears
                at all. (So, it's not symmetric to the code above.)
                #}
                <input id="id_terms" class="required" type="checkbox" name="terms"
                       {% if form.terms.value() %}checked="checked"{% endif %} />
                <label for="id_terms" class="inline-block">
                    {{ _('I agree to the') }} <a href="{{ server_uri }}/terms" target="_blank">{{ _('Terms of Service') }}</a>.
                </label>
                {% if form.terms.errors %}
                    {% for error in form.terms.errors %}
                        <div class="alert alert-error">{{ error }}</div>
                    {% endfor %}
                {% endif %}
            </div>
        {% endif %}
        <div class="submit-button-box float-right">
            <input type="submit" class="button-new sea-green" value="Register" /><br />
            <input type="hidden" name="next" value="{{ next }}" />
        </div>
    </form>
  </div>
</div>

<script type="text/javascript">
if ($('#id_email:visible').length) {
    autofocus('#id_email');
} else if ($('#id_full_name:visible').length) {
    autofocus('#id_full_name');
}

$("[name=realm_org_type]").on("change", function () {
  $(".blob").hide();
  $("#" + this.value + "_blob").show();
});
</script>

{% endblock %}
